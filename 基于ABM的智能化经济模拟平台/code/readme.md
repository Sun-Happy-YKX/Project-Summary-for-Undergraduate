# 使用方式
## **训练**
### 请将Model.py及WorkerCompanyAgent.py文件中的train参数改为1(在这两个文件的开头处)。
### 此后，windows系统下控制台运行.\batch_train.bat,即可开始训练，默认训练200轮，随时可中断(Ctrl+c)，不会影响中断前训练轮次的成果。
### 此后，如果未对代码进行调整，再次运行.\batch_train.bat可基于此前的训练成果继续训练。若对代码进行了调整，请删除：
- company_record.csv文件
- worker_record.csv文件
- average_reward文件夹
- company_buffer文件夹
- worker_buffer文件夹
### 从头开始训练

### Mac、linux的批处理文件还没写，要训练请在修改完train参数后运行 Model.py，运行一次，训练一轮。
### 默认一轮有一个eps，一个eps有10个season，一个season为10个round，round为最小单位。这些参数可以在Model.py文件开头处调整，但尽量不要调整eps，因为程序由于某种未知原因，单次运行跑的流程越长，进度越慢(比如说eps_0时，3s就能跑完一个round，但是eps_10是可能要30s才能跑完一个round，所以尽量采用"少食多餐"的方式，一次跑一个eps，多跑几次)


## **运行模型**
### 请将Model.py及WorkerCompanyAgent.py文件中的train参数改为0。而后运行 Model.py。默认运行10个season，每个season有10个round，调整方式同上。
---
# 开发指南：

## (一)任务分配
### MLX：金融和经济知识文档、中期报告（内容和格式）、答辩ppt和讲演  
### ZLY：开发； 中期报告（主要来排版）、银行的实现
### SJY：企业的销售和生产功能、大小企业的分类、企业同银行的接口
### YKX：代码重构，设计更有利于后续开发的代码结构、部分可视化
### WZX：制定开发计划、设计Model和Agent基本框架，实现基本企业的招聘和解聘功能和部分可视化、答辩

## (二)mesa的基本说明
### Agent类是我们的代理（也可以理解为主体），代表这社会中的各个角色：公司、个人、银行、政府等等。
>To Be Finished...  
>
### Model类是我们的模型，承担着调度所有Agent对象的任务；
1. model的`scheduler`--在**时间**上对各Agent对象进行管理：  
    `scheduler`决定了当`model.scheduler.step()`调用时哪些`agent`对象执行`agent的step（）`；
    `scheduler`是`model`的一个成员属性，mesa有三个，其中`RandomActivation（）`是最常用的一个，
    表示每次`scheduler.step()`会唤醒所有的`agent`，并打乱`agent`的顺序执行并各自`step（）`；
2.  `gird`--在空间上对Agent对象进行管理  
    把空间划为棋盘状（`width`和`height`），并为`agent`赋予坐标；
    必要时可以移动，移动方式目前我只了解了随机选取临近的8个位置之一；

3.  我们在对代码进行书写的时候，生产、雇佣、烧鱿鱼等操作实质上分为两大部分
    1.  通过智能算法判定我们应该为该行为分配哪些资源？分别分配多少资源？即类`CompanyAgent`的方法`produce_estimate()`
    2.  通过这个项目可以让内置的属性有哪些变化，`produce_process()`  
    ***我们中期只需要完成`xxx_process()`的部分，对应的`xxx_estimate()`部分寒假再完成***
   
## (三)代码规范
1. 类名***大驼峰***
2. ***一切和类相关***的属性、方法、函数（全局的但是处理类对象的）命名使用***小写下划线***
3. 空行和空格符合PEP8
 
## (四)git使用  
1.  在Git上如果有时push或者pull不了也许是因为链接的是iNanKai而不是NKU
2.  各自的本地分支需要命名为姓名简称：zly、mlx、wzx、sjy、ykx
3.  最好开issue并且一个merge request对应一个issue
 
----
## CompanyAgent类
1.    这个类基本流程已完成，可以被Model文件引用而正常运行，但是其中与其他类的交互需要补充，主要是```appy_for_loan```和```repay_loan```两个成员函数中需要补充对银行属性进行修改的操作，在```get_a_worker_from_talent_market```和```it_s_time_to_settle```两个成员函数中需要补充对工薪阶层属性进行修改的操作，具体位置已于代码中注释标出
**(完成补充后请修改此信息)**
2.    此外需要设定的相关参数有：
```
    1.原材料单价
    2.生产一件产品所需要的原材料数
    3.每件产品的售价
    4.政府税率
    5.银行利息率

    这些参数的设定都在文件头部，除此之外的魔法数字，在智能化之后都将被剔除，无须关注
```  
3.    成员函数中函数名以judge开头的、以及形如get_**_factors的，都是且仅是后续需要智能算法真正实现的。
4.    后续需要对step函数做调整，因为商品售卖阶段需要工薪阶层来购买，感觉需要多线程，另外企业的吞并或许也需要多线程，吞并函数目前没有给出，后续再补充
5.    目前企业负债的计算方式为，企业类有记录负债的成员变量，每还一点贷款，负债量就少一点；每贷一点，负债量就多一点；每轮结束，负债量根据利息增加。也就是说：没有把每笔贷款分开记录，后续再补充
----
